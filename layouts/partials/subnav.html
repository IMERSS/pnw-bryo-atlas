{{- $navWidth := "hx-max-w-[90rem]" -}}
{{- with .Site.Params.navbar.width -}}
{{ if eq . "normal" -}}
{{ $navWidth = "hx-max-w-screen-xl" -}}
{{ else if eq . "full" -}}
{{ $navWidth = "max-w-full" -}}
{{ end -}}
{{- end -}}

<div class="imerss-subnav">
    <nav class="hx-mx-auto hx-flex hx-items-center hx-justify-end hx-gap-2 hx-h-16 hx-px-6 {{ $navWidth }}">

        {{- $currentPage := . -}}
        {{- range .Site.Menus.main -}}
        {{- if eq .Params.type "search" -}}
        {{- partial "search.html" (dict "params" .Params) -}}
        {{- else -}}
        {{- $link := .URL -}}
        {{- $external := strings.HasPrefix $link "http" -}}
        {{- with .PageRef -}}
        {{- if hasPrefix . "/" -}}
        {{- $link = relLangURL (strings.TrimPrefix "/" .) -}}
        {{- end -}}
        {{- end -}}

        {{/* Display icon menu item */}}
        {{- if .Params.icon -}}
        {{- $rel := cond (eq .Params.icon "mastodon") "noreferrer me" "noreferrer" }}
        <a class="hx-p-2 hx-text-current" {{ if $external }}target="_blank" rel="{{ $rel }}"{{ end }} href="{{ $link }}" title="{{ or (T .Identifier) .Name | safeHTML }}">
            {{- partial "utils/icon.html" (dict "name" .Params.icon "attributes" "height=24") -}}
            <span class="hx-sr-only">{{ or (T .Identifier) .Name | safeHTML }}</span>
        </a>
        {{- else -}}
        {{- $active := or ($currentPage.HasMenuCurrent "main" .) ($currentPage.IsMenuCurrent "main" .) -}}
        {{- $activeClass := cond $active "hx-font-medium" "hx-text-gray-600 hover:hx-text-gray-800 dark:hx-text-gray-400 dark:hover:hx-text-gray-200" -}}
        <a
                title="{{ or (T .Identifier) .Name | safeHTML }}"
                href="{{ $link }}"
                {{ if $external }}target="_blank" rel="noreferrer"{{ end }}
                class="contrast-more:hx-text-gray-700 contrast-more:dark:hx-text-gray-100 hx-relative -hx-ml-2 hx-hidden hx-whitespace-nowrap hx-p-2 md:hx-inline-block {{ $activeClass }}"
        >
            <span class="hx-text-center">{{ or (T .Identifier) .Name | safeHTML }}</span>
        </a>
        {{- end -}}
        {{- end -}}
        {{- end -}}


        <button type="button" aria-label="Menu" class="hamburger-menu -hx-mr-2 hx-rounded hx-p-2 active:hx-bg-gray-400/20 md:hx-hidden">
            {{- partial "utils/icon.html" (dict "name" "hamburger-menu" "attributes" "height=24") -}}
        </button>
    </nav>
</div>
